<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Writing</title>
    <link
      href="https://fonts.googleapis.com/css?family=Noto+Serif+SC"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="./main.css" />
    <style>
      .container {
        padding-top: 25px;
        padding-bottom: 25px;
      }
      .poetry-link {
        font-size: 18px;
        color: #234;
      }
      .badge--light {
        color: #456;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h2>旧的印记</h2>
      <p>
        <small><b>2013 ~ 2016</b></small>
      </p>
      <div class="title-links">
        <div class="bouncing-loader">
          <span class="bouncing-loader--item"></span>
          <span class="bouncing-loader--item"></span>
          <span class="bouncing-loader--item"></span>
        </div>
      </div>
    </div>
    <script
      src="https://code.jquery.com/jquery-3.3.1.min.js"
      integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
      crossorigin="anonymous"
    ></script>
    <script>
      $(function() {
        var $titleLinks = $('.title-links');
        var render = function(data) {
          var s = '';
          $.each(data, function(index, item) {
            s += `<p><a class="poetry-link text-decoration--none" href="./poetry.html?title=${encodeURI(
              item.title
            )}">${item.title}</a> <small class='badge--light'>${item.type === 1 ? '[旧诗]' : ''}</small></p>`;
          });
          $titleLinks.html(s);
        };
        window.setTimeout(function() {
          $.get('./poetries.json')
            .done(function(data, type, xhr) {
              var lastModified = localStorage.getItem('last_modified');
              var nowLastModified = new Date(
                xhr.getResponseHeader('last-modified')
              )
                .getTime()
                .toString();
              console.log(lastModified, nowLastModified);
              if (!lastModified || lastModified != nowLastModified) {
                localStorage.setItem('last_modified', nowLastModified);
                localStorage.setItem('poetries', JSON.stringify(data));
              }
              render(data);
            })
            .fail(function(res) {
              console.log(res);
              $titleLinks.html('获取数据失败，可以打开控制台查询错误信息！');
            });
        }, 500);
      });
    </script>
  </body>
</html>
